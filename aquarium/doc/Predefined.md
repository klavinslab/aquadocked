Predefined Functions for Plankton and Oyster
===
### by Eric Klavins
### May 2014

Arrays
---
--------------------------

### length(a)
Returns the length of the array a.
	
### append(a,x)
Creates a new array from a by copying a and appending x to it. Note that a push would be done with a = append(a,x).
	                             
### concat(a,b)
Returns a new array consisting of a and b concatenated together
	
### unique(a)
Returns a new array representing the same set, but with no repeats.

### transpose(M)
Transpose the array of arrays M. Each row needs the to have the same number of columns.

### take(a,i,n)
Take n consecutive entries from the array a starting at index i.

### range(a,b,delta)
Returns the array [a, a+delta, ..., b]

Hashes
---
---------------------------------------------------------------------------------

### merge(g,h)
Returns a merge version of the hashes g and h, with keys in g taking precedence.
	                             
### keys(h)
Returns an array of the keys in h.
	
### key(h,k)
Returns true if k is a key in h and false otherwise.
	
### delete(h,k)
Returns a new hash with they key (and associated value for) k deleted.
	
Strings
---
------------------------------------------------------------------------------

### to_string(expr)
Converts the expression expr into a string. E.g. to_string([1,2]) gives "[1,2]".
	
Math
---
--------------------------------------

Standard math fucntions include mod, log, log2, log10, cos, sin, tan, acos, asin, atan, atan2, sqrt, max, min, floor, and ceil.

Samples and Items
---
-----------------------------------------
	
### info(i)
Returns the sample information of item (when it is an item of a sample), or gives an error if i is not an item of a sample. Usually i is a sample returned by a take or produce command. Alternatively, i can be the id of a sample. 	                           

### quantity(a)
Returns the number number of items in the inventory with this object type named by the argument a, if a is a string. If a is a hash of the form { object: string, sample: string }then quantity returns the number of its with both the object and sample type (e.g. the number of aliquots (the object type) of a given primer (the sample type)).
	                             
### min_quantity(objecttype)
Returns the minimum allowable quantity of the object type.
	
### max_quantity(objecttype)
Returns the maximum desired quantity of the object type.
	
### find(table,spec)
Does a general database query, to some extent subsuming the above commands, although it is
slower. Examples:

	find(:item, { id: 938 }) # finds item 938
	find(:item, { sample: { name: "pLAB1" } }) # finds all items with sample=pLAB1
	find(:sample, { sample_type: { name: "Plasmid" }}) # finds all plasmid samples
	find(:task, { task_prototype: { name: "Daily" }})) # finds all Daily tasks
	 
Tasks
---
-----------------------------------

### tasks(prototype,status)	
Returns all tasks with the given prototype and status (each of which should be strings). Each task is represented as a hash with ields :id, :name, :specification, and other databases-specific fields. Note: You can also use the 'find' function to get tasks.
								
### get_task_status(task)
Returns the status of a task. The task should be of the form returned by the tasks function, and preferably was generated by the tasks function.
								  
### set_task_status(task,status)
Sets the status of task to the string specified by the status argument. The task should be of the form returned by the tasks function, and preferably was generated by the tasks function. This function is polymorphic and can also take and array of tasks in its first argument.

Collections
---

------------------------------------------

Collections are items whose handler is 'collection'. They have a data field of the form { matrix: [ [ 1,2,3], [4,5,6] ] }, which would in this example represent a 2x3 collection. The numbers in the matrix correspond to samples (not to items). The following functions act on collections.

### col_dimensions(c)
Returns the dimensions of the collection c.

### col_get(c,i,j)
Returns the sample id at location i,j in the collection c.

### col_set(c,i,j,val)
Sets the i,j entry of c to the sample id val.

### col_get_matrix(c)
Returns the matrix part of c. This could also be done with find(:item,{id: c})[:data][:matrix], by the way.

## col_transfer(sourcelist,destlist)
Here, sourcelist and destlist should be lists of collections, as item ids. The function goes through the slots in the collections in the source list from left to right, top to bottom, and first to last and copies the sample ids in those slots to empty slots in destlist. Note that the dimensions of the collections need not be the same. The function returns a list of the transfers that the use should perform, and that can be displayed as a table in a step function. The format of this table is

      [
	[ sid, r, c, did, R, C ],
        ...
      ]

where sid is a source collection id, r and c are the row and column of the source slot, did is a destination collection id, and R and C are the row and column of the destination slot.

### 

Time
---
-------------------------------------------------

### time()
Returns a hash with the date and time. For example, time() might return something like the following.

	{:seconds=>14, :minutes=>8, :hours=>12, :day=>29, 
	:weekday=>"Tuesday", :month=>"April", :year=>2014}

